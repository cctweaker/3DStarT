//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

void load_config()
{
    if (load_wifi())
        cfg_wifi = true;
}

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

bool load_wifi()
{
    if (!LittleFS.begin())
        return false;

    // open config file for reading
    File configFile = LittleFS.open(wifi_cfg_file, "r");
    if (!configFile)
        return false;

    DynamicJsonDocument doc(2048);

    // Read content from config file.
    deserializeJson(doc, configFile);
    configFile.close();
    LittleFS.end();

    if (doc.containsKey("SSIDa"))
        strlcpy(SSIDa, doc["SSIDa"], sizeof(SSIDa));
    if (doc.containsKey("PASSa"))
        strlcpy(PASSa, doc["PASSa"], sizeof(PASSa));

    if (doc.containsKey("SSIDb"))
        strlcpy(SSIDb, doc["SSIDb"], sizeof(SSIDb));
    if (doc.containsKey("PASSb"))
        strlcpy(PASSb, doc["PASSb"], sizeof(PASSb));

    if (doc.containsKey("start_wifi"))
        start_wifi = doc["start_wifi"];

    doc.clear();

    return true;
}

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

const char *save_wifi()
{
    if (!LittleFS.begin())
        return littlefs_fail;

    DynamicJsonDocument doc(2048);

    doc["SSIDa"] = SSIDa;
    doc["PASSa"] = PASSa;
    doc["SSIDb"] = SSIDb;
    doc["PASSb"] = PASSb;

    doc["start_wifi"] = start_wifi;

    yield();

    // serialize & write config
    File configFile = LittleFS.open(wifi_cfg_file, "w");
    if (!configFile)
        return file_write_fail;

    serializeJson(doc, configFile);
    configFile.close();

    doc.clear();

    return file_write_success;
}

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

const char * web_format_fs()
{

    if (!LittleFS.begin())
        return littlefs_fail;

    LittleFS.format();
    LittleFS.end();

    return file_write_success;
}

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
